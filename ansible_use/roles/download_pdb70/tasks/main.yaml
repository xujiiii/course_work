- name: Make sure project root exists
  ansible.builtin.file:
    state: directory
    path: "{{ project_root }}"
    mode: '0755'
- name: Check pdb70 is present
  stat: path="{{ project_root }}/Data/pdb70"
  register: pdb70_exist
- name: Create folder to install pdb
  when: pdb70_exist.stat.exists == False
  ansible.builtin.file:
    path: "{{ project_root }}/Data/pdb70"
    state: directory 
- name: Download the gz file
  when: pdb70_exist.stat.exists == False
  ansible.builtin.get_url:
    url: "{{ pdb_url }}"
    dest: "{{ project_root }}/Data/pdb70/{{ archive_filename }}"
    force: yes
  register: download_result 
- name: decode gz file
  when: download_result.changed or download_result.dest is defined
  ansible.builtin.command:
    cmd: "tar -xzvf {{ project_root }}/Data/pdb70/{{ archive_filename }}" 
  args:
    chdir: "{{ project_root }}/Data/pdb70" 
- name: delete the gz file
  when: pdb70_exist.stat.exists == False
  ansible.builtin.file:
    path: "{{ project_root }}/Data/pdb70/{{ archive_filename }}"
    state: absent 
